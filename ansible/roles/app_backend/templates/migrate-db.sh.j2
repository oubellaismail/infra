#!/bin/bash
set -euo pipefail

CONTAINER_NAME="{{ app.name }}-backend"
LOG_FILE="/var/log/{{ app.name }}/migrations.log"

echo "$(date) - Starting database migration..." | tee -a $LOG_FILE

# Adapt this command based on your migration tool (e.g., Flyway, Liquibase)
docker exec "$CONTAINER_NAME" java -jar /app/app.jar db migrate

if [ $? -eq 0 ]; then
    echo "$(date) - SUCCESS: Database migration completed" | tee -a $LOG_FILE
else
    echo "$(date) - ERROR: Database migration failed" | tee -a $LOG_FILE
    exit 1
fi